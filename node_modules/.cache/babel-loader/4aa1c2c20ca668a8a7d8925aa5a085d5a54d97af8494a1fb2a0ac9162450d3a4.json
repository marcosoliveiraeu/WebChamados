{"ast":null,"code":"import axios from 'axios';\nimport { jwtDecode } from 'jwt-decode';\nconst baseURL = 'https://localhost:7137';\nlet storedAccessToken = localStorage.getItem('accessToken');\nlet storedRefreshToken = localStorage.getItem('refreshToken');\nconst axiosInstance = axios.create({\n  baseURL,\n  headers: {\n    Authorization: `Bearer ${storedAccessToken}`\n  }\n});\naxiosInstance.interceptors.request.use(async req => {\n  if (!storedAccessToken) {\n    storedAccessToken = localStorage.getItem('accessToken');\n    req.headers.Authorization = `Bearer ${storedAccessToken}`;\n  }\n  const token = jwtDecode(storedAccessToken);\n  const currentTime = Date.now() / 1000;\n  const isExpired = token.exp < currentTime;\n  console.log(\"!isExpired = \" + !isExpired);\n  if (!isExpired) return req;\n  if (!storedRefreshToken) {\n    storedRefreshToken = localStorage.getItem('refreshToken');\n    req.headers.Authorization = `Bearer ${storedRefreshToken}`;\n  }\n  console.log(\"token = \" + storedRefreshToken);\n\n  /*\r\n  console.log(\"axiosInstance - antes \");\r\n    const refreshResponse = await axios.post(`${baseURL}/api/Usuario/Refresh/`);\r\n    console.log(\"axiosInstance - depois \");\r\n    if (refreshResponse.data.flag) {\r\n      const { accessToken: newAccessToken, refreshToken: newRefreshToken } = refreshResponse.data;\r\n      localStorage.setItem('accessToken', newAccessToken);\r\n      localStorage.setItem('refreshToken', newRefreshToken);\r\n      \r\n      req.headers.Authorization = `Bearer ${newAccessToken}`;\r\n    }\r\n  \r\n  */\n\n  return req;\n});\nexport default axiosInstance;","map":{"version":3,"names":["axios","jwtDecode","baseURL","storedAccessToken","localStorage","getItem","storedRefreshToken","axiosInstance","create","headers","Authorization","interceptors","request","use","req","token","currentTime","Date","now","isExpired","exp","console","log"],"sources":["C:/Users/Administrador/Documents/GitHub/WebChamados/WebChamados/React/chamadosreact/src/utils/AxiosInstance.js"],"sourcesContent":["import axios from 'axios'\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\n\r\nconst baseURL = 'https://localhost:7137'\r\n\r\nlet storedAccessToken = localStorage.getItem('accessToken') ;\r\nlet storedRefreshToken = localStorage.getItem('refreshToken');\r\n\r\n\r\nconst axiosInstance = axios.create({\r\n    baseURL,\r\n    headers:{Authorization: `Bearer ${storedAccessToken}`}\r\n});\r\n\r\naxiosInstance.interceptors.request.use(async req => {\r\n    if(!storedAccessToken){\r\n        storedAccessToken = localStorage.getItem('accessToken') ;\r\n        req.headers.Authorization = `Bearer ${storedAccessToken}`\r\n    }\r\n\r\n    const token = jwtDecode(storedAccessToken);\r\n\r\n    const currentTime = Date.now() / 1000;\r\n\r\n    const isExpired = token.exp < currentTime;\r\n\r\n    console.log(\"!isExpired = \" + !isExpired);\r\n\r\n    if(!isExpired) return req;\r\n    \r\n    if(!storedRefreshToken){\r\n        storedRefreshToken = localStorage.getItem('refreshToken') ;\r\n        req.headers.Authorization = `Bearer ${storedRefreshToken}`\r\n    }\r\n\r\n    console.log(\"token = \" + storedRefreshToken);\r\n\r\n    /*\r\n    console.log(\"axiosInstance - antes \");\r\n\r\n    const refreshResponse = await axios.post(`${baseURL}/api/Usuario/Refresh/`);\r\n\r\n    console.log(\"axiosInstance - depois \");\r\n\r\n    if (refreshResponse.data.flag) {\r\n        const { accessToken: newAccessToken, refreshToken: newRefreshToken } = refreshResponse.data;\r\n        localStorage.setItem('accessToken', newAccessToken);\r\n        localStorage.setItem('refreshToken', newRefreshToken);\r\n        \r\n        req.headers.Authorization = `Bearer ${newAccessToken}`;\r\n\r\n    }\r\n    \r\n    */\r\n    \r\n    return req;\r\n})\r\n\r\n\r\nexport default axiosInstance;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,SAAS,QAAQ,YAAY;AAGtC,MAAMC,OAAO,GAAG,wBAAwB;AAExC,IAAIC,iBAAiB,GAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;AAC3D,IAAIC,kBAAkB,GAAGF,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;AAG7D,MAAME,aAAa,GAAGP,KAAK,CAACQ,MAAM,CAAC;EAC/BN,OAAO;EACPO,OAAO,EAAC;IAACC,aAAa,EAAG,UAASP,iBAAkB;EAAC;AACzD,CAAC,CAAC;AAEFI,aAAa,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,MAAMC,GAAG,IAAI;EAChD,IAAG,CAACX,iBAAiB,EAAC;IAClBA,iBAAiB,GAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;IACvDS,GAAG,CAACL,OAAO,CAACC,aAAa,GAAI,UAASP,iBAAkB,EAAC;EAC7D;EAEA,MAAMY,KAAK,GAAGd,SAAS,CAACE,iBAAiB,CAAC;EAE1C,MAAMa,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI;EAErC,MAAMC,SAAS,GAAGJ,KAAK,CAACK,GAAG,GAAGJ,WAAW;EAEzCK,OAAO,CAACC,GAAG,CAAC,eAAe,GAAG,CAACH,SAAS,CAAC;EAEzC,IAAG,CAACA,SAAS,EAAE,OAAOL,GAAG;EAEzB,IAAG,CAACR,kBAAkB,EAAC;IACnBA,kBAAkB,GAAGF,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;IACzDS,GAAG,CAACL,OAAO,CAACC,aAAa,GAAI,UAASJ,kBAAmB,EAAC;EAC9D;EAEAe,OAAO,CAACC,GAAG,CAAC,UAAU,GAAGhB,kBAAkB,CAAC;;EAE5C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;EAMI,OAAOQ,GAAG;AACd,CAAC,CAAC;AAGF,eAAeP,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}